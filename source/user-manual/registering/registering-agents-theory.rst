.. Copyright (C) 2019 Wazuh, Inc.

.. _registering_agent_theory:

Registering agents - Additional information
===========================================

.. meta::
  :description: Registering Wazuh agents - Additional Information

.. _openssl_package_requirement:

OpenSSL package requirement
---------------------------

The ``registration service`` requires an SSL certificate on the manager in order to work. This certificate will be automatically generated by the package during the installation if the ``openssl`` package is installed. The package will create the certificate and key needed to run the authentication process called ``ossec-authd``. This certificate and the key can be found on the manager in ``/var/ossec/etc/sslmanager.cert`` and
``/var/ossec/etc/sslmanager.key``.

The ``ossec-authd`` service is used to obtain a unique key, one per each agent, which allows to authenticate with the Wazuh communication service and to encrypt traffic. The communication is done over TLS protocol.
The ``agent-auth`` program is the client application used along with ``ossec-authd`` to automatically add the agent to the manager.

.. _agent-keys-registration:

Agent keys
----------

The manager uses the file ``/var/ossec/etc/client.keys`` to store the registration record of each agent, which includes ID, name, IP, and key.
Example::

    001 Server1 any e20e0394dca71bacdea57d4ca25d203f836eca12eeca1ec150c2e5f4309a653a
    002 ServerProd 192.246.247.247 b0c5548beda537daddb4da698424d0856c3d4e760eaced803d58c07ad1a95f4c
    003 DBServer 192.168.0.1/24 8ec4843da9e61647d1ec3facab542acc26bd0e08ffc010086bb3a6fc22f6f65b

The agents also have the file ``/var/ossec/etc/client.keys`` containing only their own registration record.
Example for ``Server1`` agent::

    001 Server1 any e20e0394dca71bacdea57d4ca25d203f836eca12eeca1ec150c2e5f4309a653a

**Basic data for registering an agent**

In order to register an agent, it is necessary to provide the name and the IP of the agent.

There are several ways to set the agent IP:

 - **Any IP**: Allows the agent to connect with any IP address. Example: ``Server1`` has ``any`` IP.
 - **Fixed IP**: Allows the agent to connect only with the specified IP. Example: ``ServerProd`` has the IP ``192.246.247.247``.
 - **Range IP**: Allows the agent to connect with the IP within the specified range. Example: ``DBServer`` has the IP range ``192.168.0.1/24``.

Some registration methods automatically detect the IP of the agent during the registration process.
