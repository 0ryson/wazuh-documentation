.. Copyright (C) 2019 Wazuh, Inc.

.. _wodle_vuln_detector:

wodle name="vulnerability-detector"
====================================

.. versionadded:: 3.2.0

.. topic:: XML section name

	.. code-block:: xml

		<wodle name="vulnerability-detector">
		</wodle>

Configuration options of the Vulnerability detector wodle.

Options
-------

- `disabled`_
- `interval`_
- `run_on_start`_
- `ignore_time`_
- `provider`_

.. note:: The options ``update_ubuntu_oval``/``update_redhat_oval`` (since 3.5) and ``feed`` (since 4.0) are deprecated. It is recommended to use ``provider`` instead.

+---------------------------+-----------------------------+
| Options                   | Allowed values              |
+===========================+=============================+
| `disabled`_               | yes, no                     |
+---------------------------+-----------------------------+
| `interval`_               | A positive number (seconds) |
+---------------------------+-----------------------------+
| `run_on_start`_           | yes, no                     |
+---------------------------+-----------------------------+
| `ignore_time`_            | A positive number (seconds) |
+---------------------------+-----------------------------+
| `provider`_               | An update configuration     |
+---------------------------+-----------------------------+


disabled
^^^^^^^^

Disable the Vulnerability detector wodle.

+--------------------+-----------------------------+
| **Default value**  | no                          |
+--------------------+-----------------------------+
| **Allowed values** | yes, no                     |
+--------------------+-----------------------------+

interval
^^^^^^^^

Time between vulnerabilities detections.

+--------------------+------------------------------------------------------------------------------------------------------------------------------------------+
| **Default value**  | 5m                                                                                                                                       |
+--------------------+------------------------------------------------------------------------------------------------------------------------------------------+
| **Allowed values** | A positive number that should contain a suffix character indicating a time unit: s (seconds), m (minutes), h (hours) or d (days).        |
+--------------------+------------------------------------------------------------------------------------------------------------------------------------------+

run_on_start
^^^^^^^^^^^^

Runs updates and detections immediately when service is started.

+--------------------+---------+
| **Default value**  | yes     |
+--------------------+---------+
| **Allowed values** | yes, no |
+--------------------+---------+

ignore_time
^^^^^^^^^^^^

Time during which vulnerabilities that have already been alerted will be ignored.

+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **Default value**  | 6 hours                                                                                                                                                                   |
+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **Allowed values** | A positive number that should contain a suffix character indicating a time unit: s (seconds), m (minutes), h (hours) or d (days).                                         |
+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

provider
^^^^^^^^

Configuration block to specify vulnerability updates.

+--------------------+---------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Define a valid vulnerability information provider.                                                                                                                                                                                                                             |
|                    |                           +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                                                                                                                                                                                                                                                           |
|                    |                           |                    | canonical                                                                                                                                                                                                                                                 |
|                    |                           |                    |                                                                                                                                                                                                                                                           |
|                    |                           |                    +-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                                                                                                                                                                                                                                                           |
|                    |                           |                    | debian                                                                                                                                                                                                                                                    |
|                    |                           |                    |                                                                                                                                                                                                                                                           |
|  **Allowed tags**  | name                      | **Allowed values** +-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                                                                                                                                                                                                                                                           |
|                    |                           |                    | redhat                                                                                                                                                                                                                                                    |
|                    |                           |                    |                                                                                                                                                                                                                                                           |
|                    |                           |                    +-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |                                                                                                                                                                                                                                                           |
|                    |                           |                    | nvd                                                                                                                                                                                                                                                       |
|                    |                           |                    |                                                                                                                                                                                                                                                           |
+--------------------+---------------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **Allowed values** |                           | Disable the update configuration.                                                                                                                                                                                                                                              |
|                    | disabled                  +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | **Allowed values** | yes, no                                                                                                                                                                                                                                                   |
|                    +---------------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Feed to update.                                                                                                                                                                                                                                                                |
|                    | os                        +--------------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | **provider** | **feed**                                                                                                                                                                                                                                   |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | precise / 12                                                                                                                                                                                                                               |
|                    |                           |                    |              +--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | trusty / 14                                                                                                                                                                                                                                |
|                    |                           |                    | canonical    +--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | xenial / 16                                                                                                                                                                                                                                |
|                    |                           | **Allowed values** |              +--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | bionic / 18                                                                                                                                                                                                                                |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | wheezy / 7                                                                                                                                                                                                                                 |
|                    |                           |                    |              +--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | debian       | stretch / 8                                                                                                                                                                                                                                |
|                    |                           |                    |              +--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | jessie / 9                                                                                                                                                                                                                                 |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | redhat       | ``Does not use this option.``                                                                                                                                                                                                              |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | nvd          | ``Does not use this option.``                                                                                                                                                                                                              |
|                    |                           +--------------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | **Allowed tags**   |              | How often the vulnerability database is updated. It has priority over `update_interval`.                                                                                                                                                   |
|                    |                           |                    |              +--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | interval     | **Default value**  | The value indicated by `update_interval`.                                                                                                                                                                             |
|                    |                           |                    |              +--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | **Allowed values** | A positive number that should contain a suffix character indicating a time unit: s (seconds), m (minutes), h (hours) or d (days).                                                                                     |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | Define the link to an alternative OVAL files.                                                                                                                                                                                              |
|                    |                           |                    | url          +--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | **Allowed values** | Link to download the OVAL file obtained from `Canonical <https://people.canonical.com/~ubuntu-security/oval>`_ or `Debian <https://www.debian.org/security/oval>`_.                                                   |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | Define the path to an alternative OVAL file.                                                                                                                                                                                               |
|                    |                           |                    | path         +--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | **Allowed values** | Path where the OVAL file obtained from `Canonical <https://people.canonical.com/~ubuntu-security/oval>`_ or `Debian <https://www.debian.org/security/oval>`_ is located.                                              |
|                    +---------------------------+--------------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | How often the vulnerability database is updated.                                                                                                                                                                                                                               |
|                    |                           +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | update_interval           | **Default value**  | 1 hour.                                                                                                                                                                                                                                                   |
|                    |                           +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | **Allowed values** | A positive number that should contain a suffix character indicating a time unit: s (seconds), m (minutes), h (hours) or d (days).                                                                                                                         |
|                    +---------------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | The feed will be updated from this year.                                                                                                                                                                                                                                       |
|                    |                           +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | update_from_year          | **Default value**  | 2010.                                                                                                                                                                                                                                                     |
|                    |                           +--------------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | **provider** | **value**                                                                                                                                                                                                                                  |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | redhat       |  A valid year and greater than 1998.                                                                                                                                                                                                       |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | **Allowed values** | nvd          |  A valid year and greater than 2001.                                                                                                                                                                                                       |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | canonical    | ``Does not use this option.``                                                                                                                                                                                                              |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | debian       | ``Does not use this option.``                                                                                                                                                                                                              |
|                    +---------------------------+--------------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Define the link to an alternative feed files.                                                                                                                                                                                                                                  |
|                    |                           +--------------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | **provider** | **value**                                                                                                                                                                                                                                  |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | redhat       | Parameterized link to download the feed files obtained from `Red Hat Security Data API <https://access.redhat.com/labsinfo/securitydataapi>`_. The link parameterization is done with the ``[-]`` tag.                                     |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |  multi_url                | **Allowed values** | nvd          | Parameterized link to download the feed files obtained from `National Vulnerability Database <https://nvd.nist.gov>`_. The link parameterization is done with the ``[-]`` tag.                                                             |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | canonical    | ``Does not use this option.``                                                                                                                                                                                                              |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | debian       | ``Does not use this option.``                                                                                                                                                                                                              |
|                    |                           +--------------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | Define the first value which the tag will be substituted.                                                                                                                                                                                  |
|                    |                           |                    | start        +--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | **Allowed values** | A numeric value that in substitution with the tag forms a valid link.                                                                                                                                                 |
|                    |                           | **Allowed tags**   +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | Define the last value which the tag will be substituted.                                                                                                                                                                                   |
|                    |                           |                    | end          +--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    |              | **Allowed values** | A numeric value that in substitution with the tag forms a valid link.                                                                                                                                                 |
|                    +---------------------------+--------------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Define the path to an alternative feed files.                                                                                                                                                                                                                                  |
|                    |                           +--------------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | **provider** | **value**                                                                                                                                                                                                                                  |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | redhat       |  Path with regular expression that matches the feed files obtained from `Red Hat Security Data API <https://access.redhat.com/labsinfo/securitydataapi>`_.                                                                                 |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |  multi_path               | **Allowed values** | nvd          |  Path with regular expression that matches the feed files obtained from `National Vulnerability Database <https://nvd.nist.gov>`_.                                                                                                         |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | canonical    | ``Does not use this option.``                                                                                                                                                                                                              |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | debian       | ``Does not use this option.``                                                                                                                                                                                                              |
+                    +---------------------------+--------------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | Enable a Microsoft patch scan.                                                                                                                                                                                                                                                 |
|                    |                           +--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    | patch_scan                | **Default value**  | yes                                                                                                                                                                                                                                                       |
|                    |                           +--------------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | **provider** | **value**                                                                                                                                                                                                                                  |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | redhat       |  ``Does not use this option.``                                                                                                                                                                                                             |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           | **Allowed values** | nvd          |  yes, no                                                                                                                                                                                                                                   |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | canonical    | ``Does not use this option.``                                                                                                                                                                                                              |
|                    |                           |                    +--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                    |                           |                    | debian       | ``Does not use this option.``                                                                                                                                                                                                              |
+--------------------+---------------------------+--------------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Example of configuration
------------------------

The following configuration will update the vulnerability database for Debian 9 with a day of interval, Red Hat from 2009, Ubuntu Bionic from a local file, Ubuntu Xenial from a local repository, and the National Vulnerability Database from local files.

.. code-block:: xml

    <wodle name="vulnerability-detector">
        <disabled>no</disabled>
        <interval>5m</interval>
        <run_on_start>yes</run_on_start>
        <provider name="debian">
            <disabled>no</disabled>
            <os interval="1d">9</os>
        </provider>
        <provider name="redhat">
            <disabled>no</disabled>
            <update_from_year>2009</update_from_year>
            <update_interval>1h</update_interval>
        </provider>
        <provider name="canonical">
            <disabled>no</disabled>
            <os path="/local/feeds/oval/bionic_oval.xml">bionic</os>
            <os url="http://my_local_repo/xenial_oval.xml">xenial</os>
            <update_interval>1h</update_interval>
        </provider>
        <provider name="nvd">
            <disabled>no</disabled>
            <multi_path>/local/feeds/nvd/nvdcve-1.0-.*json$</multi_path>
        </provider>
    </wodle>

.. note:: See the :doc:`Vulnerability detector section<../../capabilities/vulnerability-detection/index>` to obtain more information about this module.
