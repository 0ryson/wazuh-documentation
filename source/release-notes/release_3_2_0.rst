.. _release_3_2_0:

3.2.0 Release Notes
===================

This section shows the most relevant new features of Wazuh v3.2.0. You will find more detailed information in our `changelog <https://github.com/wazuh/wazuh/blob/3.2/CHANGELOG.md>`_ file.

**New features:**

- `Vulnerability detector module`_
- `AWS CloudTrail module`_
- `CIS-CAT integration now support Windows OS`_
- `Cluster improvements`_

Vulnerability detector module
-----------------------------

A native vulnerability detector has been developed. This way, Wazuh is able to analyze and report vulnerabilities without dependencies on external tools.

This vulnerability detector doesn't mean an increase in the use of CPU in the agents, since the agents only collect and send the manager all the necessary information. It's the manager the one that processes all this incoming data to compare it with different vulnerabilities repositories.

Below is an example of results where a vulnerability is identified:

.. code-block:: console
	:emphasize-lines: 3

	** Alert 1518102634.685428: - vulnerability-detector,
	2018 Feb 08 16:10:34 (PC) ->vulnerability-detector
	Rule: 23504 (level 7) -> 'CVE-2017-7226 on Ubuntu 16.04 LTS (xenial) - medium.'
	vulnerability.cve: CVE-2017-7226
	vulnerability.title: CVE-2017-7226 on Ubuntu 16.04 LTS (xenial) - medium.
	vulnerability.severity: Medium
	vulnerability.published: 2017-03-22
	vulnerability.updated: 2017-03-22
	vulnerability.reference: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-7226
	vulnerability.rationale: The pe_ILF_object_p function in the Binary File Descriptor (BFD) library (aka libbfd), as distributed in GNU Binutils 2.28, is vulnerable to a heap-based buffer over-read of size 4049 because it uses the strlen function instead of strnlen, leading to program crashes in several utilities such as addr2line, size, and strings. It could lead to information disclosure as well.
	vulnerability.state: Unfixed
	vulnerability.affected_package: binutils
	vulnerability.version: 2.26.1-1ubuntu1~16.04.6

You can read more about this new module in the :doc:`Vulnerability detector section <../user-manual/capabilities/vulnerability-detector>`.

AWS CloudTrail module
---------------------

This module provides the ability to read your `AWS CloudTrail` logs directly from your AWS S3 bucket. Amazon CloudTrail support is built-in Wazuh, giving you the ability to search, analyze, and alert on AWS CloudTrail log data.

Below is an example of the JSON alert generated by this module:

.. code-block:: javascript

	{
	    "timestamp": "2018-01-07T00:00:08+0000",
	    "rule": {
	        "level": 3,
	        "description": "Amazon: ec2.amazonaws.com - TerminateInstances.",
	        "id": "80202",
	        "firedtimes": 5,
	        "mail": false,
	        "groups": [
	            "amazon"
	        ],
	        "pci_dss": [
	            "10.6.1"
	        ]
	    },
	    "agent": {
	        "id": "000",
	        "name": "manager"
	    },
	    "manager": {
	        "name": "ubuntu"
	    },
	    "id": "1515283208.24163",
	    "full_log": "{\"aws\":{\"eventVersion\":\"1.05\",\"eventID\":\"3ec09b34-fd67-4ef6-bea0-ad340db3ea84\",\"eventTime\":\"2018-01-04T17:44:39Z\",\"log_file\":\"xxxxxx_CloudTrail_us-east-xxxxxxx_xxxxxx.json.gz\",\"requestParameters\":{\"instancesSet\":{\"items\":[{\"instanceId\":\"xxxxxxxxxx\"}]}},\"eventType\":\"AwsApiCall\",\"responseElements\":{\"instancesSet\":{\"items\":[{\"instanceId\":\"xxxxxxxxxx\",\"currentState\":{\"code\":32,\"name\":\"shutting-down\"},\"previousState\":{\"code\":16,\"name\":\"running\"}}]}},\"awsRegion\":\"us-east-1\",\"eventName\":\"TerminateInstances\",\"userIdentity\":{\"userName\":\"nobody\",\"principalId\":\"xxxxxxxxxxxxx\",\"accessKeyId\":\"xxxxxxxxxxxxx\",\"invokedBy\":\"signin.amazonaws.com\",\"sessionContext\":{\"attributes\":{\"creationDate\":\"2018-01-04T16:28:51Z\",\"mfaAuthenticated\":\"false\"}},\"type\":\"IAMUser\",\"arn\":\"arn:aws:iam::12345678912:user/nobody\",\"accountId\":\"xxxxxxxxxxx\"},\"eventSource\":\"ec2.amazonaws.com\",\"requestID\":\"xxxx-xxxx-xxxx-xxxx-xxxxxxx\",\"userAgent\":\"signin.amazonaws.com\",\"sourceIPAddress\":\"xxx.xxx.xxx.xxx\",\"recipientAccountId\":\"xxxxxxxxxxx\",\"integration\":\"cloudtrail\"}}",
	    "decoder": {
	        "name": "json"
	    },
	    "data": {
	        "aws": {
	            "eventVersion": "1.05",
	            "eventID": "3ec09b34-fd67-4ef6-bea0-ad340db3ea84",
	            "eventTime": "2018-01-04T17:44:39Z",
	            "log_file": "166157441623_CloudTrail_us-east-xxxxxxx_xxxxxx.json.gz",
	            "eventType": "AwsApiCall",
	            "awsRegion": "us-east-1",
	            "eventName": "TerminateInstances",
	            "userIdentity": {
	                "userName": "nobody",
	                "principalId": "xxxxxxxxxxxxx",
	                "accessKeyId": "xxxxxxxxxxxxx",
	                "invokedBy": "signin.amazonaws.com",
	                "sessionContext": {
	                    "attributes": {
	                        "creationDate": "2018-01-04T16:28:51Z",
	                        "mfaAuthenticated": "false"
	                    }
	                },
	                "type": "IAMUser",
	                "arn": "arn:aws:iam::12345678912:user/nobody",
	                "accountId": "xxxxxxxxxxx"
	            },
	            "eventSource": "ec2.amazonaws.com",
	            "requestID": "e4b6febf-cdf2-489c-83a4-62f3adbdf7aa",
	            "userAgent": "signin.amazonaws.com",
	            "sourceIPAddress": "xxx.xxx.xxx.xxx",
	            "recipientAccountId": "xxxxxxxxxxx",
	            "integration": "cloudtrail"
	        }
	    },
	    "predecoder": {
	        "hostname": "manager"
	    },
	    "location": "/home/centos/amazonlogs/amazon.log"
	}

You can read more about this new module in the :doc:`Vulnerability detector section <../plugins/amazon/index>`.

CIS-CAT integration now support Windows OS
------------------------------------------

In the latest Wazuh release, the CIS-CAT module was focused only on Linux systems. Now, it also supports Windows systems.

Cluster improvements
--------------------

Several bugs have been fixed in the cluster. Also, its general peroformance has been improved.

The cluster is now able to synchronize user decoders, rules and CDB lists. Before sending any of those files, ``ossec-logtest`` is run to check that new rules, decoders or CDB lists are correctly defined. If the check fails, the synchronization of `only` those files is cancelled. When a client received any decoder, rule or CDB list, it also runs ``ossec-logtest``. If the check is successful, the client is automatically restarted.

The full list of files synchronized by the cluster is:

	- /etc/client.keys
	- /etc/shared
	- /etc/decoders*
	- /etc/rules*
	- /etc/lists*
	- /queue/agent-groups
	- /queue/agent-info

(*) A client node in the cluster will be restarted after receiving this file.
