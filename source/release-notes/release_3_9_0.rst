.. Copyright (C) 2019 Wazuh, Inc.

.. _release_3_9_0:

3.9.0 Release Notes
===================

In this section, we're listing the starred improvements and fixes in Wazuh 3.9.0. A complete list of changes is provided in the `change log <https://github.com/wazuh/wazuh/blob/v3.9.0/CHANGELOG.md>`_.

Wazuh Core improvements
------------------------

    The Wazuh core has received a few improvements since the last version:

Additions
^^^^^^^^^

        * A very important change is the addition of a new module to perform **Configuration Assessment** scans.

            This new module improves the way Wazuh monitors the policies. The policy files are now updated and translated to YAML with more interesting fields, these files are parsed by this new module and after that the scans are performed, in each of them, the new information gathered is stored at a database where differences between consecutive scans are made, this makes possible generating an alert for every check that has changed its result. Also, a statistical alert that summaries the checking process is generated in every scan.

            To know more about this module, let's add an example that runs a scan the 15th of every month:

                .. code-block:: xml

                    <configuration_assessment>
                        <enabled>yes</enabled>
                        <scan_on_start>yes</scan_on_start>
                        <scan_day>15</scan_day>
                        <skip_nfs>yes</skip_nfs>

                        <policies>
                            <policy>cis_debian_linux_rcl.yml</policy>
                        </policies>
                    </configuration_assessment>

            The events generated by this module are shown in **Kibana** this way:

                .. thumbnail:: ../images/release-notes/3.9.0/conf-assessment-kibana.png
                    :title: Configuration assessment events filtered in Kibana.
                    :align: center
                    :width: 100%

        * Added support in **Syscollector** for network and open ports inventory on Windows XP.
            
            Now, *Syscollector* supports ``<network>`` and ``<ports>`` on legacy *Windows XP* and *Windows Server 2003*.

        * **Syscollector** data is now decoded into dynamic fields, so we can define rules based on events from `Syscollector`:
            
            Using ``syscollector`` as the value in ``<decoded_as>`` field on a decoder will result in Kibana showing alerts as ``syscollector`` fields *(data.type.value)*

                .. thumbnail:: ../images/release-notes/3.9.0/syscollector.png
                    :title: Syscollector events filtered in Kibana.
                    :align: center
                    :width: 70%

        * New option in *File Integrity Monitoring* to enable the *health check* for ``<whodata>``.
            
            .. code-block:: bash
                
                # /var/ossec/etc/ossec.conf
                
                <syscheck>
                    <whodata>
                        <startup_healthcheck>yes</startup_healthcheck>
                    </whodata>
                </syscheck>

        * Added extra information in the agents' disconnected and removed alerts to show which agent is changing.

Improvements
^^^^^^^^^^^^

        * **ossec-remoted** daemon now shows an error message when it quits for not being properly configured:
            
            .. code-block:: bash
            
                "Remoted connection is not configured... Exiting."

        * Now **agent_auth** daemon warns users when it receives extra input arguments.
            
            .. code-block:: bash

                $ ./agent-auth -m 192.168.1.1 -i 192.168.1.2
                2019/02/05 07:00:08 agent-auth: WARNING: Extra arguments detected. They will be ignored.
                2019/02/05 07:00:08 agent-auth: INFO: Started (pid: 7252).

        * The **who-data** option works from now on *Fedora 29* because both have added *Audit 3.0 (beta)* support. 


        * Now **Syscollector** gets *bonded* interfaces' MAC.

        * From this version on, the *manager* will know the primary IP of the agents that will be updated every time an agent sends a keep alive.

            The manager will store that IP in the global database and it will be printed in the Wazuh app. With this change, although an agent is registered with **any** as IP, the manager will know the agent's current IP. 

        * Added support to AWS organizations in `CloudTrail` service:

            With this enhancement, It is possible getting logs for organizations by adding ``<aws_organization_id>ORGANIZATION</aws_organization_id>`` in the wodle configuration:

            .. code-block:: xml

                <wodle name="aws-s3">
                    <disabled>no</disabled>
                    <bucket type="cloudtrail">
                        <name>cloudtrail</name>
                        <aws_organization_id>wazuh</aws_organization_id>
                        <aws_profile>default</aws_profile>
                    </bucket>
                    <remove_from_bucket>no</remove_from_bucket>
                    <interval>20m</interval>
                    <run_on_start>yes</run_on_start>
                    <skip_on_error>no</skip_on_error>
                </wodle>

        * Optimized network performance in *Remoted* by introducing a network buffer to cache incomplete messages from agents.
            
            With this method, *Remoted* does not wait for complete messages when it's not necessary, improving the performance of the network greatly.

        * Labels starting with ``_`` are reserved now for internal use only (this was added to allow the manager to know the agent's IP upper mentioned).

        * Improved cluster performance: Embedded *Python 3* and updated to *asyncio*.

Fixes
^^^^^

        - Fixed error in Syscollector for Windows older than Vista when gathering the hardware inventory.
        - Fixed an error in the OSquery configuration validation.
        - Wazuh manager starts regardless of the contents of ``local_decoder.xml``.
        - Delete empty fields from Windows Eventchannel alerts.
        - Fixed memory leak and crash in Vulnerability Detector.
        - ...

Wazuh Ruleset improvements
---------------------------

    In this release, the Ruleset has added two differences since the last version:

        * Added *Sysmon rules* to new Windows eventchannel format.

            The anomalies on event **ID 1** of *Sysmon* can be detected now thanks to these new rules.

        * Added *Configuration Assessment* module files:

            The team has added a full directories structure with many new rules for the *Configuration Assessment* module and many other features related to this module as decoders, new policy files in YAML, etc. 

Wazuh API
---------

    *Wazuh API* has received multiple additions that allow users to make different API calls to perform Wazuh tasks more easily.

        * Now, the *Wazuh API* can make calls to edit the Wazuh configuration files as ``ossec.conf`` and to edit rules lists and decoders files.

            This, in combination with the Kibana app, results in a place where all the configuration is done, avoiding bouncing between files to change a single word, and making a more centralized and easy configuration of Wazuh.

        * Also, added calls to restart manager nodes in the cluster, to get CDB lists, and even get configuration assessment policies and checks.

            Examples of these improvements are:

                Making calls to *get CDB lists*:

                .. code-block:: bash

                    # curl -u foo:bar -k -X GET "CDB list address"

                Making calls to *restart* manager nodes in the cluster and *validate* configuration:

                .. code-block:: bash

                    # curl -u foo:bar -k -X PUT "https://127.0.0.1:55000/manager/restart?pretty"

        * Fixed documentation regarding *DELETE /agents* API call and *older_than* default value.